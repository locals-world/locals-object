<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-selector/iron-selector.html">
<link rel="import" href="locals-objectlayer.html">

<!--
An element providing a solution to no problem in particular.

Example:

    <locals-object></locals-object>
Example:
<locals-object>
<h2>Hello locals-object</h2>
</locals-object>
@demo demo/index.html
@hero hero.svg
-->
<dom-module id="locals-object">
<template>
  <style>
      :host {
        display: block;
        box-sizing: border-box;
        position: relative;

      }

      .canvas {
         width: 400px;
        height: 400px;  
      }
      
      .absolutepos {
        position: absolute;
         width: 400px;
        height: 400px;  
      }

      locals-objectlayer {
        width: 100%;
        height: 100%;
        border: 1px solid red; 
      }

      .editbnts {
        z-index: 10;
      }

      .layerselector {

      }

      .iron-selected {
        color: pink;
      }


    </style>

  <template is="dom-if" if="{{_isMode(mode,'edit')}}">
    <div class="absolutepos editbnts">
      <button on-tap="prev">PREV</button>
      <button on-tap="next">NEXT</button>
    </div>
  </template>

  <div class="canvas" on-tap="_toEdit">
    <template is="dom-repeat" items="{{config.layers}}" >
      <div class="absolutepos">
        <locals-objectlayer options="[[item.options]]" selected="[[_arrayItem(config.objectconfig.*,index)]]" editmode="[[_isMode(mode,'edit')]]"></locals-objectlayer>
      </div>
    </template>
  </div>

  <div class="layerselector">
    <template is="dom-if" if="{{_isMode(mode,'edit')}}">
      <template is="dom-if" if="{{multilayer}}">
        <iron-selector selected="{{_selectedlayer}}">
          <template is="dom-repeat" items="{{config.layers}}" >
            <div on-tap="selectlayer" data-args$="{{index}}">{{item.name}}</div>
          </template>
        </iron-selector>
      </template>
    </template>
  </div>

</template>

<script>
    Polymer({
      is: 'locals-object',

      properties: {
        /**
         * `config` is the internal configuration and state of the object
         */
        config: {
          type: Object,
          notify: true
        },
        // `mode` is either 'view' or 'edit'
        mode: {
          type:String,
          value: "view"
        },

        _selectedlayer: {
          type: Number,
          value :0
        }
      },

      _arrayItem: function(change, index) {
        return change.base[index];
      },

      // Element Lifecycle

      ready: function() {
      },

      attached: function() {
        this.multilayer = this.config.layers.length > 1;
      },

      // select a different layer
      selectlayer: function(e){
        this._selectedlayer = e.target.getAttribute('data-args');
      },

      // select previous item in current layer, rolls around if you're at the beginning
      prev: function() {
        if (this.config.objectconfig[this._selectedlayer] == 0) {
          this.set('config.objectconfig.' + this._selectedlayer, this.config.layers[this._selectedlayer].options.length - 1);
        } else {
          this.set('config.objectconfig.' + this._selectedlayer, this.config.objectconfig[this._selectedlayer] - 1);
        }
      },

      // select next item in current layer, rolls around if you're at the end
      next: function() {
        if (this.config.objectconfig[this._selectedlayer] == this.config.layers[this._selectedlayer].options.length - 1) {
          this.set('config.objectconfig.' + this._selectedlayer, 0);
        } else {
          this.set('config.objectconfig.' + this._selectedlayer, this.config.objectconfig[this._selectedlayer] + 1);
        }
      },

      detached: function() {
      },

      _isMode: function(a,b){
        return a==b;
      },

      _toEdit: function(){
        this.mode = "edit";
      }

      // Element Behavior

    
    });
  </script>
</dom-module>